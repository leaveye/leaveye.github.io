<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Happy Coding</title><link href="http://leaveye.github.io/" rel="alternate"></link><link href="http://leaveye.github.io/feeds/system.atom.xml" rel="self"></link><id>http://leaveye.github.io/</id><updated>2015-10-03T14:27:31+08:00</updated><entry><title>升级 OS X El Capitan</title><link href="http://leaveye.github.io/upgrade-to-el-capitan.html" rel="alternate"></link><updated>2015-10-03T14:27:31+08:00</updated><author><name>Levi G</name></author><id>tag:leaveye.github.io,2015-10-03:upgrade-to-el-capitan.html</id><summary type="html">&lt;p&gt;10 月 1 日发现 Apple 推送了 El Capitan 的更新。第一时间点击升级，准备体验一下。&lt;/p&gt;
&lt;p&gt;几小时后，升级包终于下载完成了，在电脑上多了个『安装 El Capitan』的软件。果断打开。&lt;/p&gt;
&lt;p&gt;回答确认了安装程序的一系列问题，并且第一次重启电脑后，进度条走的非常慢，最后卡在 30% 左右不动了。&lt;/p&gt;
&lt;p&gt;担心了 1 个小时变砖的问题，决定还是强行关机。重启后没有继续安装，而是自动进入到升级前的系统。庆幸了一下。再次点击安装软件，重启进入安装过程。&lt;/p&gt;
&lt;p&gt;这次虽然进度条依旧很慢，但是顺利完成了安装过程。登录系统后，发现又再次出现了一年前修复的 &lt;code&gt;kernel_task&lt;/code&gt; 进程 CPU 占用率暴高的问题。搜索到了&lt;a href="http://www.zhihu.com/question/19611376"&gt;结果&lt;/a&gt;，准备照此办理。&lt;/p&gt;
&lt;p&gt;查询到我的设备型号是 &lt;code&gt;MacBookPro8,2&lt;/code&gt;，要删除的文件没有权限：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ls -lO@ MacBookPro8_2.plist
/System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/ACPI_SMC_PlatformPlugin.kext/Contents/Resources
-rw-r--r--  &lt;span class="m"&gt;1&lt;/span&gt; root  wheel  restricted   14K  &lt;span class="m"&gt;9&lt;/span&gt; &lt;span class="m"&gt;17&lt;/span&gt; 09:20 MacBookPro8_2.plist
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;尝试过安全模式下，仍然没有权限。搜索得知，这个 &lt;code&gt;restricted&lt;/code&gt; 属性是 El Capitan 新加功能 SIP (System Intregrity Protection) 的一部分。常规启动下的 root 用户并没有这部分操作权限。有的说通过设置 &lt;code&gt;nvrom bootarg='rootless=0'&lt;/code&gt; 来尝试解决，似乎这样风险有点大。还是根据&lt;a href="https://forums.developer.apple.com/thread/3981"&gt;这里&lt;/a&gt;，使用 OS X 自带的 Recovery OS 来弄吧。这里我还因为硬盘里没有恢复分区而折腾了两个小时，又是找制作修复磁盘的工具又是借 U 盘的，直到后来看到帖子说只需要能连到网络就可以进入恢复系统……&lt;/p&gt;
&lt;p&gt;进入 Recovery OS 的方法是启动电脑时，播放声音后，苹果 Logo 前，按 Command+R 键即可。可我这已经没有启动声音很久了，只好在黑屏就开始反复按这个组合键。&lt;/p&gt;
&lt;p&gt;在恢复系统中，进入终端后：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;# 进入硬盘 我这里硬盘卷标叫做『Macintosh HD』
cd /Volumes/Macintosh\ HD
# 进入文件所在路径
cd System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/ACPI_SMC_PlatformPlugin.kext/Contents/Resources
# 关闭 SIP
csrutil disable
# 删除文件
rm MacBookPro8_2.plist
# 还原 SIP
csrutil enable
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;这里我先关闭 SIP 才删除文件的，怀疑不必关闭 SIP 直接就能操作，不过我没有验证。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;再次重启，系统终于恢复正常了。&lt;/p&gt;</summary><category term="os x"></category><category term="el capitan"></category><category term="kernel_task"></category><category term="sip"></category></entry></feed>